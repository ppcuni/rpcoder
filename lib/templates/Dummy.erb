/* generated by rpcoder <%= version %> */
using System;
using System.Collections;
using System.Collections.Generic;
using Aiming.IteratorTasks;

namespace <%= name_space %>
{
	public class <%= api_class_name %>Dummy : <%= api_class_name %>Interface
	{
		public RpcoderErrorHandler ErrorHandler { get; set; }
		public string BaseUrl { get; set; }
		public RpcoderLogger Logger { get; set; }
		public void AddCommonParameter(string key, string value)
		{
		}
		public string RemoveCommonParameter(string key)
		{
			return "";
		}

		private RpcoderError error = null;
		
		private Dictionary<string, ArrayList> dummySuccess = new Dictionary<string, ArrayList>();

		public void SetDummySuccess(string functionName, ArrayList success)
		{
			dummySuccess.Add(functionName, success);
		}

		private ArrayList GetDummySuccess(string functionName)
		{
			return dummySuccess[functionName];
		}

		public void SetDummyError(RpcoderError error)
		{
			this.error = error;
		}

		private bool IsError { get { return this.error != null; } }

		<%- functions.each do |func| -%>
		<%-
			response = func.name.camelize + "Response"
			successHandler = "Action<" + response + ">"
			params_excluded_error_handler = func.params.map{|i| [i.array_or_type, i.name.to_s.camelize(false)].join(' ') } + [successHandler + ' success']
			params = params_excluded_error_handler + ['RpcoderErrorHandler error']
		-%>
		public IEnumerator <%= func.name.camelize %>(<%= params_excluded_error_handler.join(', ') %>)
		{
			return this.<%= func.name.camelize %>(<%= (func.params.map{|i| i.name.to_s.camelize(false) } + ['success']).join(', ') %>, null, null, null);
		}

		public IEnumerator <%= func.name.camelize %>(<%= params.join(', ') %>, Action throwIfCancelRequested, Action<float> reportProgress)
		{
			if( !HandleError(error) )
			{
				<%- if func.has_return_type? -%>
				ArrayList arguments = GetDummySuccess("<%= func.name.camelize %>");
				<%- end-%>
				<%-
					index = -1
				-%>
				success(new <%= response %>(){<%= func.return_types.map{|i| i.name.to_s.camelize + " = (#{i.array_or_type})arguments[#{index+=1}]" }.join(",\n\t\t\t\t\t") %>});
			}
			yield return null;
		}

		<%- end -%>

		private bool HandleError(RpcoderErrorHandler errorHandler)
		{
			if( IsError )
			{
				if(errorHandler != null)
				{
					errorHandler(error.ErrorType, error.Message, error.TargetScene);
				}
				else
				{
					ErrorHandler(error.ErrorType, error.Message, error.TargetScene);
				}
				return true;
			}
			return false;
		}
	}
}
